<!doctype html><html lang=en-us><head><title>TCP-Routing on Cloud Foundry // Ramblings about all things technical</title><link rel="shortcut icon" href=https://jamesclonk.io/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Fabio Berchtold"><meta name=description content="The Swisscom Application Cloud, which is based on the open source industry standard Cloud Foundry, offers an exciting new feature for its users. TCP routing, the ability to support and expose any TCP-based, non-HTTP application to the world. Let's have a closer look and learn how to use TCP routing."><link rel=stylesheet href=https://blog.jamesclonk.io/css/main.min.69f3560017b43a1fc9233086d35c5c1844537f85db3f349ed92009e395fa1b93.css><meta name=twitter:card content="summary"><meta name=twitter:title content="TCP-Routing on Cloud Foundry"><meta name=twitter:description content="The Swisscom Application Cloud, which is based on the open source industry standard Cloud Foundry, offers an exciting new feature for its users. TCP routing, the ability to support and expose any TCP-based, non-HTTP application to the world. Let's have a closer look and learn how to use TCP routing."><meta property="og:title" content="TCP-Routing on Cloud Foundry"><meta property="og:description" content="The Swisscom Application Cloud, which is based on the open source industry standard Cloud Foundry, offers an exciting new feature for its users. TCP routing, the ability to support and expose any TCP-based, non-HTTP application to the world. Let's have a closer look and learn how to use TCP routing."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.jamesclonk.io/posts/tcp-routing-on-cloud-foundry/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-04-15T10:33:42+02:00"><meta property="article:modified_time" content="2018-04-15T10:33:42+02:00"></head><body><header class=app-header><a href=https://blog.jamesclonk.io/><img class=app-header-avatar src=/images/fabio_berchtold.jpg alt="Fabio Berchtold"></a><h1>Ramblings about all things technical</h1><nav class=app-header-menu><a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a>
-
<a class=app-header-menu-item href=/about/>About</a></nav><p>Working with tech is fun!</p><div class=app-header-social><a href=https://github.com/JamesClonk target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>TCP-Routing on Cloud Foundry</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-user"><title>user</title><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Fabio Berchtold</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Apr 15, 2018</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg><a class=tag href=/tags/cloud-foundry/>cloud foundry</a>
<a class=tag href=/tags/containers/>containers</a>
<a class=tag href=/tags/networking/>networking</a>
<a class=tag href=/tags/routing/>routing</a>
<a class=tag href=/tags/app-cloud/>app cloud</a></div></div></header><div class=post-content><blockquote><p><em>The Swisscom Application Cloud, which is based on the open source industry standard Cloud Foundry, offers an exciting new feature for its users. TCP routing, the ability to support and expose any TCP-based, non-HTTP application to the world. Let&rsquo;s have a closer look and learn how to use TCP routing.</em></p></blockquote><p>The <a href=https://developer.swisscom.com/>Swisscom Application Cloud</a> is based on <a href=https://www.cloudfoundry.org/>Cloud Foundry</a>, the leading open source industry standard for building your own platform-as-a-service.</p><p><img src=/images/tcp-devportal.png alt=Devportal></p><p>One of the many great features Cloud Foundry offers is TCP routing, the ability to route and expose any TCP-based traffic from your application to the outside world.
TCP routing in Cloud Foundry is based on reserving ports on a TCP router group for an application, mapped to a TCP-route and domain which is then exposed by a frontend load-balancer like our F5. Incoming traffic from a Client on that port will be forwarded to your application container instances using a round-robin load-balancing policy. TCP router groups are a collection of multiple Cloud Foundry TCP routers, ensuring high availability.</p><p><img src=/images/tcp-route-ports.png alt=Devportal></p><p>TCP Routing allows you to push applications onto the Application Cloud you previously would not have thought of.</p><p>For example you could push <a href=https://memcached.org/>Memcached</a> as an app, an in-memory cache that communicates via TCP:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cf push -o memcached memcached
</span></span><span style=display:flex><span>Creating app memcached in org swisscom / space examples as user1...
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Showing health and status <span style=color:#204a87;font-weight:700>for</span> app memcached in org swisscom / space examples as user1...
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>requested state: started
</span></span><span style=display:flex><span>instances: 1/1
</span></span><span style=display:flex><span>usage: 1G x <span style=color:#0000cf;font-weight:700>1</span> instances
</span></span><span style=display:flex><span>urls: memcached.scapp.io
</span></span><span style=display:flex><span>state since cpu memory disk details
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#0 running 2018-03-05 12:31:31 PM 0.0% 0 of 1G 0 of 1G</span>
</span></span></code></pre></div><p>And all you need to do now to expose it over TCP would be to simply bind a TCP-route to it, specifying the port by which it is going to be exposed to the outside world:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cf map-route memcached tcp.scapp.io --port <span style=color:#0000cf;font-weight:700>35666</span>
</span></span><span style=display:flex><span>Creating route tcp.scapp.io:35666 <span style=color:#204a87;font-weight:700>for</span> org swisscom / space examples as user1...
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Adding route tcp.scapp.io:35666 to app memcached in org  swisscom / space examples as user1...
</span></span><span style=display:flex><span>OK
</span></span></code></pre></div><p>Your application should now be exposed over TCP port <em>35666</em> on the domain <code>tcp.scapp.io</code>.
Let&rsquo;s verify that this actually works, by using telnet to open up a TCP connection to our app on that domain and port:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ telnet tcp.scapp.io <span style=color:#0000cf;font-weight:700>35666</span>
</span></span><span style=display:flex><span>Trying 211.222.233.100...
</span></span><span style=display:flex><span>Connected to tcp.scapp.io.
</span></span><span style=display:flex><span>Escape character is <span style=color:#4e9a06>&#39;^]&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> greeting <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#0000cf;font-weight:700>11</span>
</span></span><span style=display:flex><span>Hello World
</span></span><span style=display:flex><span>STORED
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>quit
</span></span><span style=display:flex><span>Connection closed by foreign host.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ telnet tcp.scapp.io <span style=color:#0000cf;font-weight:700>35666</span>
</span></span><span style=display:flex><span>Trying 211.222.233.100...
</span></span><span style=display:flex><span>Connected to tcp.scapp.io.
</span></span><span style=display:flex><span>Escape character is <span style=color:#4e9a06>&#39;^]&#39;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get greeting
</span></span><span style=display:flex><span>VALUE greeting <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#0000cf;font-weight:700>11</span>
</span></span><span style=display:flex><span>Hello World
</span></span><span style=display:flex><span>END
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>quit
</span></span><span style=display:flex><span>Connection closed by foreign host.
</span></span></code></pre></div><p>Works like a charm! üòÉ</p><p>Another interesting type of application possible thanks to TCP routing would be to deploy a game server that communicates also over TCP only.
Let&rsquo;s try that out with <a href=https://minecraft.net/>Minecraft</a>:</p><p><img src=/images/tcp-routing.png alt=Devportal></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ cf push minecraft -o itzg/minecraft-server -i <span style=color:#0000cf;font-weight:700>1</span> -m 1536M --no-start
</span></span><span style=display:flex><span>$ cf create-route examples tcp.scapp.io --port <span style=color:#0000cf;font-weight:700>28888</span>
</span></span><span style=display:flex><span>$ cf map-route mcs tcp.scapp.io --port <span style=color:#0000cf;font-weight:700>28888</span>
</span></span><span style=display:flex><span>$ cf set-env mcs EULA <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>$ cf set-env mcs MOTD <span style=color:#4e9a06>&#39;Minecraft powered by Swisscom Application Cloud&#39;</span>
</span></span><span style=display:flex><span>$ cf start minecraft
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ cf app minecraft
</span></span><span style=display:flex><span>Showing health and status <span style=color:#204a87;font-weight:700>for</span> app minecraft in org  swisscom / space examples as user1...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>name:              minecraft
</span></span><span style=display:flex><span>requested state:   started
</span></span><span style=display:flex><span>instances:         1/1
</span></span><span style=display:flex><span>usage:             1.5G x <span style=color:#0000cf;font-weight:700>1</span> instances
</span></span><span style=display:flex><span>routes:            tcp.scapp.io:28888
</span></span><span style=display:flex><span>last uploaded:     Mon <span style=color:#0000cf;font-weight:700>12</span> Feb 15:26:23 UTC <span style=color:#0000cf;font-weight:700>2018</span>
</span></span><span style=display:flex><span>stack:             cflinuxfs2
</span></span><span style=display:flex><span>docker image:      itzg/minecraft-server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     state     since                  cpu    memory           disk          details
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#0   running   2018-03-28T22:44:18Z   1.2%   959.5M of 1.5G   35.2M of 1G</span>
</span></span></code></pre></div><p>There you go, Minecraft running on the Application Cloud:
<img src=/images/tcp-minecraft.png alt=Devportal></p><p>Running a Minecraft server on the Application Cloud would previously not have been possible due to its TCP only nature.</p><p>Now of course we would still be missing a persistent filesystem here, so your world will be lost once your app gets restarted. But that is a problem hopefully soon being fixed too by adding <a href=https://docs.cloudfoundry.org/running/deploy-vol-services.html>Volume Services</a> to Cloud Foundry.</p><p>To use the TCP routing feature on the Swisscom Public Application Cloud offering, simply send a support request detailing your intended use for it to get an appropriate quota setting for your organization enabled so you can start pushing TCP-based apps onto the Cloud. üëç</p><p>For more details on how to use the TCP routing from an end-user perspective you can consult the documentation for further information:
<a href=https://docs.developer.swisscom.com/devguide/deploy-apps/routes-domains.html#create-route-with-port>https://docs.developer.swisscom.com/devguide/deploy-apps/routes-domains.html#create-route-with-port</a></p></div><div class=post-footer></div></article></main></body></html>