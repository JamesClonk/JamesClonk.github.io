<!doctype html><html lang=en-us>
<head>
<title>Automatic database backups with Backman // Ramblings about all things technical</title>
<link rel="shortcut icon" href=https://jamesclonk.io/favicon.ico>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Fabio Berchtold">
<meta name=description content="Creating Postgres backups with Backman, a Cloud Foundry application that can backup and restore your databases">
<link rel=stylesheet href=https://blog.jamesclonk.io/css/main.min.0cd1e8c02130c0b61d70f667046a924a31bb965c4f2ece488c05513ad5e78880.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Automatic database backups with Backman">
<meta name=twitter:description content="Creating Postgres backups with Backman, a Cloud Foundry application that can backup and restore your databases">
<meta property="og:title" content="Automatic database backups with Backman">
<meta property="og:description" content="Creating Postgres backups with Backman, a Cloud Foundry application that can backup and restore your databases">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.jamesclonk.io/posts/database-backups-with-backman/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2020-03-17T11:17:37+02:00">
<meta property="article:modified_time" content="2020-03-17T11:17:37+02:00">
</head>
<body>
<header class=app-header>
<a href=https://blog.jamesclonk.io/><img class=app-header-avatar src=/images/fabio_berchtold.jpg alt="Fabio Berchtold"></a>
<h1>Ramblings about all things technical</h1>
<nav class=app-header-menu>
<a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a>
-
<a class=app-header-menu-item href=/about/>About</a>
</nav>
<p>Working with tech is fun!</p>
<div class=app-header-social>
<a href=https://github.com/JamesClonk target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Automatic database backups with Backman</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-user"><title>user</title><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
Fabio Berchtold
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Mar 17, 2020
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
3 min read
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=/tags/database/>database</a>
<a class=tag href=/tags/postgres/>postgres</a>
<a class=tag href=/tags/backups/>backups</a>
<a class=tag href=/tags/backman/>backman</a>
<a class=tag href=/tags/cloud-foundry/>cloud foundry</a>
<a class=tag href=/tags/kubernetes/>kubernetes</a>
</div>
</div>
</header>
<div class=post-content>
<p>I&rsquo;ve always been a big fan of using Postgres as my main database backend for all my applications, but I&rsquo;ve also always been paranoid about losing data and the need for backups. So when I started pushing my applications onto the <a href=http://developer.swisscom.com/>Swisscom Application Cloud</a> and attaching Postgres databases to them (hosted by <a href=https://www.elephantsql.com/>ElephantSQL</a>), I needed a way to ensure there will always be backups, that they are under my control and supervision and hosted externally / off-site from the Postgres-provider itself, preferably on an S3 object store.</p>
<p>What do you do in that situation? Well of course you start writing your own backup solution! ðŸ˜‚</p>
<p>And that is how <a href=https://github.com/JamesClonk/backman>Backman</a> was born.</p>
<h2 id=-backman>ðŸ’½ Backman</h2>
<p>Backman is a backup manager application for <a href=https://www.cloudfoundry.org/>Cloud Foundry</a> (and Kubernetes), that can be used to periodically backup all your databases and stores all backup files onto an S3-compatible object storage of your choice.</p>
<p>While it started out as a Cloud Foundry specific application, I&rsquo;ve later also added <a href=https://github.com/vmware-tanzu/carvel-ytt>ytt</a> templates and a ready-made Kubernetes <a href=https://github.com/swisscom/backman/blob/master/kubernetes/example/deploy.yml>deployment</a> to it.
And of course once we&rsquo;ve entered Kubernetes territory it didn&rsquo;t take long to also add a Prometheus <a href=https://github.com/JamesClonk/backman/blob/master/README.md#metrics><code>/metrics</code></a> endpoint to it, which will show you information about backups and restores.</p>
<p>In its current state Backman supports backup and restore operations of the following databases:</p>
<ul>
<li>MariaDB / MySQL</li>
<li>PostgreSQL</li>
<li>MongoDB</li>
<li>Elasticsearch</li>
<li>Redis (backup-only, no restore)</li>
</ul>
<p>Backman can be used either as an entirely self-running application without needing any user interaction, but it also provides an <a href="https://petstore.swagger.io/?url=https://raw.githubusercontent.com/JamesClonk/backman/master/swagger.yml">API</a> and a web UI through which you can manually trigger backup or restore operations.</p>
<p>(Yes, I completely overdid it. Originally this project was only supposed to periodically backup my Postgres databases onto S3 in the background, now look at it&mldr; ðŸ˜‚)</p>
<h3 id=service-listing>Service listing</h3>
<p><img src=https://raw.githubusercontent.com/JamesClonk/backman/master/static/images/backman_services_listing.png alt="Service Listing"></p>
<p>Each service Backman knows about either via autodiscovery or got configured otherwise will show up in this service listing / overview.</p>
<h3 id=service-view>Service view</h3>
<p><img src=https://raw.githubusercontent.com/JamesClonk/backman/master/static/images/backman_service_view.png alt="Service View"></p>
<p>Here you can see all the information about this particular database and its backups, such as the current backup schedule and the backup file retention settings. According to the schedule Backman will create a backup on a daily basis for this database, every day at 22:14:42 (the cron specification of Backman is in a 6-digit format with the first digit being &ldquo;<code>Seconds</code>&rdquo;, similar to the format used by the <a href=http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/tutorial-lesson-06.html>Quartz Scheduler</a>).</p>
<p>You could also trigger a backup immediately with the <em>&ldquo;Trigger Backup&rdquo;</em> button, download or delete each of the backups if necessary, or trigger a restore by clicking <em>&ldquo;Restore&rdquo;</em>.</p>
<p>Each service can have its own configuration in Backman and if no such specific configuration is provided it will assume a set of sane default settings, such as for example a randomized daily backup schedule, just like you can see in the screenshot above.</p>
<h3 id=more>More&mldr;</h3>
<p>Check out the <a href=https://github.com/JamesClonk/backman/blob/master/README.md>README.md</a> to learn all about its many other configuration and usage options.</p>
</div>
<div class=post-footer>
</div>
</article>
</main>
</body>
</html>