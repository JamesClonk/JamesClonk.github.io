<!doctype html><html lang=en-us>
<head>
<title>Aiming for High Availability // Ramblings about all things technical</title>
<link rel="shortcut icon" href=https://jamesclonk.io/favicon.ico>
<meta charset=utf-8>
<meta name=generator content="Hugo 0.88.1">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Fabio Berchtold">
<meta name=description content>
<link rel=stylesheet href=https://blog.jamesclonk.io/css/main.min.9bba7fde0750c7bda25f057fa3c3b60a9bc8a01eca8636633114e4a19d3d4b43.css>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Aiming for High Availability">
<meta name=twitter:description content="From Old to New A bit over a year ago I have rewritten my entire personal website from PHP into Golang. Before that I was using a typical LAMP stack hoster to host my website, where all you usually do is upload your PHP files via FTP and everything is hosted there for you, the most simple entry in the world of &ldquo;web development&rdquo;.
This old PHP based code has been archived on GitHub and can still be found here in case you&rsquo;re interested:">
<meta property="og:title" content="Aiming for High Availability">
<meta property="og:description" content="From Old to New A bit over a year ago I have rewritten my entire personal website from PHP into Golang. Before that I was using a typical LAMP stack hoster to host my website, where all you usually do is upload your PHP files via FTP and everything is hosted there for you, the most simple entry in the world of &ldquo;web development&rdquo;.
This old PHP based code has been archived on GitHub and can still be found here in case you&rsquo;re interested:">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.jamesclonk.io/posts/aiming-for-high-availability/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2015-02-03T10:42:34+02:00">
<meta property="article:modified_time" content="2015-02-03T10:42:34+02:00">
</head>
<body>
<header class=app-header>
<a href=https://blog.jamesclonk.io/><img class=app-header-avatar src=/images/fabio_berchtold.jpg alt="Fabio Berchtold"></a>
<h1>Ramblings about all things technical</h1>
<nav class=app-header-menu>
<a class=app-header-menu-item href=/>Home</a>
-
<a class=app-header-menu-item href=/tags/>Tags</a>
-
<a class=app-header-menu-item href=/about/>About</a>
</nav>
<p>Working with tech is fun!</p>
<div class=app-header-social>
<a href=https://github.com/JamesClonk target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>GitHub</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a>
</div>
</header>
<main class=app-container>
<article class=post>
<header class=post-header>
<h1 class=post-title>Aiming for High Availability</h1>
<div class=post-meta>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-user"><title>user</title><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
Fabio Berchtold
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Feb 3, 2015
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
4 min read
</div>
<div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>
<a class=tag href=/tags/high-availability/>high availability</a>
<a class=tag href=/tags/digital-ocean/>digital ocean</a>
<a class=tag href=/tags/haproxy/>haproxy</a>
</div>
</div>
</header>
<div class=post-content>
<h2 id=from-old-to-new>From Old to New</h2>
<p>A bit over a year ago I have rewritten my entire personal website from PHP into Golang. Before that I was using a typical <a href=https://en.wikipedia.org/wiki/LAMP_(software_bundle)>LAMP stack</a> hoster to host my website, where all you usually do is upload your PHP files via FTP and everything is hosted there for you, the most simple entry in the world of &ldquo;web development&rdquo;.</p>
<p>This old PHP based code has been archived on GitHub and can still be found here in case you&rsquo;re interested:</p>
<ul>
<li><a href=https://github.com/JamesClonk/php-website-frontend>https://github.com/JamesClonk/php-website-frontend</a></li>
<li><a href=https://github.com/JamesClonk/php-website-backend>https://github.com/JamesClonk/php-website-backend</a></li>
<li><a href=https://github.com/JamesClonk/PDO_DB>https://github.com/JamesClonk/PDO_DB</a></li>
</ul>
<p>This traditional setup has served its purpose very well since over 10 years already, but it was time to take a dive into more advanced stuff. Having recently learned Golang this provided me with the opportunity to put my newfound Go programming skills to the test, and also figure out what other ways there are to host your own websites.</p>
<p>I&rsquo;ve also split up the new Golang based website into multiple components and repositories, hosted within its own GitHub project: <a href=https://github.com/jamesclonk-io>https://github.com/jamesclonk-io</a></p>
<ul>
<li><a href=https://github.com/jamesclonk-io/jcio-frontend>jcio-frontend</a> is the main frontend website, acting like a CMS and reading data from <a href=https://github.com/jamesclonk-io/content>content</a></li>
<li><a href=https://github.com/jamesclonk-io/moviedb-frontend>moviedb-frontend</a> is the web frontend to my movie database</li>
<li>and <a href=https://github.com/jamesclonk-io/moviedb-backend>moviedb-backend</a> the backend, providing an API for the frontend and querying data from a database (SQLite or Postgres)</li>
<li>all these components make use of <a href=https://github.com/jamesclonk-io/stdlib>stdlib</a> for shared code / libraries</li>
</ul>
<p>Since Golang compiles your code into binaries it is not as simple as uploading these files via FTP to a hoster anymore, I needed a place where my code can actually run now.</p>
<h3 id=my-own-vm-on-the-internet>My own VM on the Internet?</h3>
<p>So, where can I now run my Golang binaries?</p>
<p>This is where I discovered <a href=https://www.digitalocean.com/>Digital Ocean</a>.</p>
<p>Unlike a traditional hosting provider Digital Ocean allows users to create entire virtual machines, to which you can then SSH into and install and run whatever software you want. This was my first contact with a so-called &ldquo;Cloud&rdquo; provider.</p>
<p>All you need to do is create an account on Digital Ocean, login and fill in your billing details, and the next thing you know you can create new virtual machines on demand, and they only take a few minutes to start up and be ready to use. ðŸ˜ƒ</p>
<h2 id=high-availability-design>High Availability Design</h2>
<p>But having everything running together on this single VM poses another new problem, what if this VM goes down? My website would go down with it! ðŸ˜±
Of course I need my personal website to be highly available, distributed among multiple instances / VMs!</p>
<p>So I designed my own <a href=https://en.wikipedia.org/wiki/High_availability>High-Availability architecture</a>, to keep my website up and running at all times:</p>
<p><img src=https://raw.githubusercontent.com/JamesClonk/jcio/master/jcio.png alt="JCIO architecture"></p>
<ul>
<li><a href=https://github.com/JamesClonk/jcio>https://github.com/JamesClonk/jcio</a></li>
</ul>
<p>The idea of this is to completely automate the deployment of a fully HA setup of my own personal infrastructure on Digital Ocean. It spins up all the VMs needed, installs the software and configures everything to be up and running. Also I&rsquo;m going to use <a href=https://github.com/rqlite/rqlite>RQLite</a> (basically a distributed version of SQLite) to have as the database backend for my applications.</p>
<p>For the orchestration of all the necessary Docker containers between these VMs I rely on using <a href=https://github.com/ehazlett/shipyard/tree/7bf471c0832c3772c9b041607dbc42017012fa1e>Shipyard</a>. It&rsquo;s a tool that allows you to manage containers on &ldquo;nodes&rdquo; via a graphical user interface / dashboard:</p>
<p><img src=/images/shipyard.jpg alt="Docker Shipyard"></p>
<p>Here are the two repositories needed to deploy &ldquo;master&rdquo; and &ldquo;slave&rdquo; nodes:</p>
<ul>
<li><a href=https://github.com/JamesClonk/jcio-nginx-master>https://github.com/JamesClonk/jcio-nginx-master</a></li>
<li><a href=https://github.com/JamesClonk/jcio-nginx-slave>https://github.com/JamesClonk/jcio-nginx-slave</a></li>
</ul>
<p>In the end all I need to do is run <em><a href=https://github.com/JamesClonk/jcio/blob/master/provision.sh>./provision.sh</a></em> and it will spin up my entire setup have everything running afterwards without me having to do any manual configuration, etc.</p>
<hr>
<h2 id=addendum---20210801>Addendum - 2021.08.01</h2>
<p>Since I&rsquo;ve recently started porting all my old blog posts onto my new blog (this very thing here you are reading ðŸ˜‚), I&rsquo;ve stumbled upon this old beauty of a crazy self-made HA architecture. What a monstrosity!</p>
<p>This thing was so bloody unnecessarily complicated, no wonder I abandoned it as soon as I could when I learned about <a href=https://www.cloudfoundry.org/>Cloud Foundry</a>. I more or less immediately just started deploying all my Golang web apps directly onto the <a href=developer.swisscom.com>Swisscom Application Cloud</a> back then, it greatly simplified everything.</p>
<p>And these days I have everything automated with <a href=https://github.com/features/actions>GitHub Actions</a> and running on <a href=/posts/my-own-kubernetes/>my own Kubernetes</a> cluster anyway..</p>
</div>
<div class=post-footer>
</div>
</article>
</main>
</body>
</html>